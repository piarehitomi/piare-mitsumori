<index html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ ªå¼ä¼šç¤¾ãƒ”ã‚¢ãƒ¬ã‚­ã‚¿ã‚¬ãƒ¯ è¦‹ç©æ›¸ä½œæˆï¼ˆå°åˆ·åŸºæº–ç‰ˆ v7.3.1R PrintPro / ipad-ops r3ï¼‰</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{ --ink:#111; --muted:#666; --line:#ddd; }
  *{box-sizing:border-box;}
  html,body{height:100%;}
  body{ font-family:"BIZ UDPGothic", system-ui, -apple-system, "Hiragino Kaku Gothic ProN","Yu Gothic", Meiryo, sans-serif; color:var(--ink); margin:0; background:#fff;}
  .sheet{ width:210mm; min-height:297mm; padding:14mm 16mm; margin:0 auto; }
  header{ display:flex; justify-content:space-between; align-items:flex-start; gap:10mm; margin-bottom:6mm; }

  /* å·¦ï¼å®›å */
  .to-block{ flex:1 1 auto; }
  .to-label{font-size:12px; color:var(--muted); margin-bottom:2mm;}
  .to-address{ font-size:12.5px; line-height:1.5; white-space:pre-wrap; margin-bottom:2mm; }
  .to-name-line{ position:relative; display:flex; align-items:baseline; gap:0; margin-bottom:2mm; flex-wrap:nowrap; }
  .to-name{ font-weight:700; font-size:19px; letter-spacing:0.02em; width:auto !important; min-width:6ch; display:inline-block; }
  .sama{font-size:16px; font-weight:700; margin-left:1mm;}
  .to-tel{font-size:12.5px; color:#222;}

  /* å³ï¼ä¼šç¤¾æƒ…å ±ï¼ˆãƒ­ã‚´â†â†’ä¼šç¤¾åã‚’æ¨ªä¸¦ã³ï¼‰ */
  .from-block{ flex:0 0 92mm; }
  .brand-row{
    display:flex;
    align-items:flex-start; /* ãƒ­ã‚´ã‚’ä¼šç¤¾åã¨åŒã˜é«˜ã•ã‹ã‚‰é–‹å§‹ */
    gap:6mm;
    justify-content:flex-end;
  }
  .logo{ width:34mm; flex:0 0 auto; margin-top:0.5mm; }
  .logo img{ width:100%; height:auto; object-fit:contain; display:block; }
  .company{ text-align:left; white-space:pre-line; margin:0; }
  .company .name{ font-size:16px; font-weight:800; letter-spacing:0.02em; display:block; }
  .company .addr, .company .tel{ font-size:12px; line-height:1.5; }

  /* LINEï¼šæ ãƒŠã‚·ï¼ˆãƒ­ã‚´ã®ä¸‹ã«æ¨ªä¸¦ã³ï¼‰ */
  .line-wrap{ display:flex; gap:4mm; justify-content:flex-end; align-items:center; margin-top:2mm; }
  .line-wrap img{ width:20mm; height:20mm; object-fit:contain; display:block; border:none; padding:0; background:transparent; }

  .title{ text-align:left; font-size:22px; font-weight:700; margin:5mm 0 4mm 0; padding-bottom:2mm; border-bottom:2px solid var(--ink); letter-spacing:0.02em; }

  table{ width:100%; border-collapse:collapse; }
  th, td{ border:1px solid var(--line); padding:6px 8px; vertical-align:middle; font-size:12.5px; }
  th{ background:#fafafa; text-align:center; font-weight:700; }
  td.right{text-align:right;} td.center{text-align:center;}
  .unit-badge{font-size:11px; color:var(--muted); margin-left:2px;}
  .section-title{ font-weight:700; margin:8mm 0 2mm; font-size:14px; }

  input[type="text"], input[type="number"]{ width:100%; font:inherit; padding:6px 8px; border:1px solid #ccc; background:#fff; }
  input[type="number"]{ text-align:right; }
  .money{ padding-right:8px; }

  /* æ•°é‡ï¼ˆç”»é¢æ™‚ã¯å¤§ãã‚ã§OKï¼‰ */
  .qty-input{
    font-size:28px; padding:10px 8px; height:54px; line-height:1.1;
    -webkit-appearance: none; appearance: textfield; min-width:70px;
  }

  /* è¦‹ç©æ˜ç´°ã®åˆ—å¹…ï¼ˆç”»é¢æ™‚ï¼‰ */
  #itemsTable th:nth-child(1){ width:36%; }
  #itemsTable th:nth-child(2), #itemsTable td:nth-child(2){ width:8%; }
  #itemsTable th:nth-child(4), #itemsTable td:nth-child(4){ width:23%; }

  /* è¿½åŠ å·¥äº‹ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—å¹…ï¼ˆç”»é¢æ™‚ï¼‰ */
  #addTable th:nth-child(2), #addTable td:nth-child(2){ width:10%; }
  #addTable th:nth-child(3), #addTable td:nth-child(3){ width:18%; }
  #addTable th:nth-child(4), #addTable td:nth-child(4){ width:20%; }

  .grand-amount{ font-weight:800; font-size:16px; padding-right:8px; }

  .notes{ min-height:24mm; border:1px solid var(--line); padding:6px 8px; font-size:12.5px; background:#fff; }
  .notes-fixed{ border:1px solid var(--line); padding:6px 8px; font-size:12.5px; background:#fff; margin-bottom:4mm; }
  .fixed-text{ white-space:pre-wrap; line-height:1.6; }
  .notes-free-wrap{ margin-top:2mm; }
  .notes-label{ font-size:12px; color:var(--muted); margin:0 0 2mm; }

  /* ç”»é¢ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
  .controls{ position:sticky; top:0; background:#fff; border-bottom:1px solid #eee; padding:10px 12px; display:flex; gap:8px; align-items:center; z-index:5; }
  .controls .pill{ border-radius:999px; padding:6px 12px; font-size:12.5px; background:#f6f6f6; border:1px solid #e5e5e5; }

  /* è¿½åŠ å·¥äº‹ï¼šãƒœã‚¿ãƒ³ãƒ‘ãƒƒãƒ‰ */
  .add-buttons{ display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:8px; }
  .add-btn{
    display:flex; align-items:center; justify-content:space-between;
    gap:8px; padding:10px 12px; border:1px solid #ccc; background:#fff; cursor:pointer; border-radius:10px;
    font-size:13px;
  }
  .add-btn .name{ flex:1 1 auto; text-align:left; }
  .add-btn .unit{ font-variant-numeric: tabular-nums; }

  .pad-row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:6px; }
  .pad-row input[type="number"]{ width:90px; }

  /* ä¸‹éƒ¨ï¼šå°åˆ·é–‹å§‹ãƒœã‚¿ãƒ³ */
  .footer-print{ margin:10mm 0 0; display:flex; justify-content:flex-end; }
  .footer-print button{ font:inherit; padding:10px 16px; border:1px solid #ccc; background:#fff; cursor:pointer; border-radius:10px; }

  /* å°åˆ·æœ€é©åŒ– */
  @page{ size:A4; margin:12mm; }
  @media print{
    .controls, .add-buttons, .pad-row, .footer-print{ display:none !important; }
    body{ background:#fff; }
    .sheet{ padding:0; width:auto; min-height:auto; }
    input{ border:none !important; padding:0 !important; margin:0 !important; outline:none !important; background:none !important; }

    /* â–¼ è¡Œé–“ï¼†ä½™ç™½ã‚’ã•ã‚‰ã«åœ§ç¸®ï¼ˆ1æšåã¾ã‚Šå„ªå…ˆï¼‰ */
    th, td{
      padding:3px 4px !important;
      font-size:11.2px !important;
      line-height:1.18 !important;
      border-width:0.8px !important;
    }
    header{ margin-bottom:2.6mm !important; gap:5mm !important; }
    .title{ margin:2.6mm 0 1.8mm 0 !important; padding-bottom:1mm !important; }
    .section-title{ margin:4mm 0 1mm !important; }

    /* â‘  æ•°é‡ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’é‡‘é¡ã¨åŒã˜ã‚µã‚¤ã‚ºã«çµ±ä¸€ */
    .qty-input{
      font-size:11.2px !important;
      height:auto !important;
      line-height:1.18 !important;
      padding:3px 4px !important;
      min-width:auto !important;
    }

    /* å®›åã®ã€ŒãŠå®¢æ§˜ã€ãƒ©ãƒ™ãƒ«ã¯å°åˆ·éè¡¨ç¤º */
    .to-label{ display:none !important; }

    /* å®›åï¼šã€Œæ§˜ã€ã¯åå‰ã®æœ€å¾Œã®æ–‡å­—ã‹ã‚‰15mmå³ã«é…ç½® */
    .to-name-line{ position:relative !important; }
    .to-name{ font-size:26px !important; font-weight:800; width:auto !important; }
    .sama{
      font-size:22px !important; font-weight:800;
      position:absolute !important; left:auto; top:auto;
      margin:0 !important; white-space:nowrap;
    }

    /* è¿½åŠ å·¥äº‹ï¼šæ“ä½œåˆ—ã‚’éè¡¨ç¤ºï¼ˆãƒ˜ãƒƒãƒ€ï¼‹å„è¡Œï¼‰ */
    #addTable th:nth-child(5),
    #addTable td:nth-child(5){ display:none !important; }

    /* â‘¡ åˆè¨ˆé‡‘é¡ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ 32px â†’ ç´„21.33pxï¼ˆ=2/3ï¼‰ã¸ç¸®å° */
    .grand-amount{ font-size:21.33px !important; }

    /* â‘¢ ã€Œå‚™è€ƒãƒ¡ãƒ¢ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰ã€ã¯å°åˆ·æ™‚ã¯ä¸¸ã”ã¨éè¡¨ç¤º */
    .notes-free-wrap{ display:none !important; }

    /* LINEãƒ­ã‚´ï¼šä¼šç¤¾æƒ…å ±ã®ç›´ä¸‹ã«â€œ5mmâ€ä½™ç™½ã§é…ç½® */
    .line-wrap{ margin-top:5mm !important; }

    /* LINEç”»åƒã®æ ãªã—ï¼ˆå¿µæŠ¼ã—ï¼‰ */
    .line-wrap img{ border:none !important; padding:0 !important; background:transparent !important; }
  }
</style>
</head>
<body>

<div class="controls" role="toolbar" aria-label="æ“ä½œ">
  <span class="pill">æ¨™æº–å–ä»˜å·¥äº‹ å°æ•°ï¼š
    <button onclick="chgStd(-1)">ï¼</button>
    <strong id="stdCount" style="display:inline-block; min-width:2ch; text-align:center;">1</strong>
    <button onclick="chgStd(1)">ï¼‹</button>
  </span>
  <span class="pill">åˆè¨ˆï¼ˆç¨è¾¼ï¼‰ï¼š<strong id="grandTotal">Â¥0</strong></span>
</div>

<div class="sheet">

  <header>
    <!-- å·¦ï¼šå®›å -->
    <section class="to-block">
      <div class="to-label">ãŠå®¢æ§˜</div>
      <div>
        <div class="to-address"><input id="toAddress" type="text" placeholder="ã€’â€ƒä½æ‰€ã‚’å…¥åŠ›" /></div>
        <div class="to-name-line">
          <input id="toName" class="to-name" type="text" placeholder="ãŠåå‰" />
          <span class="sama">æ§˜</span>
        </div>
        <div class="to-tel">TELï¼š<input id="toTel" type="text" placeholder="ãŠé›»è©±ç•ªå·" style="width:50%;" /></div>
      </div>
    </section>

    <!-- å³ï¼šãƒ­ã‚´ â†â†’ ä¼šç¤¾æƒ…å ±ï¼ˆç”»åƒã®ä¸¦ã³ï¼‰ -->
    <section class="from-block">
      <div class="brand-row">
        <div class="logo">
          <img id="logoImg" alt="PIARE KITAGAWA LOGO" src="piarelogo.png" />
        </div>
        <div class="company">
<span class="name">æ ªå¼ä¼šç¤¾ãƒ”ã‚¢ãƒ¬ã‚­ã‚¿ã‚¬ãƒ¯</span>
<span class="addr">é•·æµœå¸‚æ›½æ ¹ç”º350</span>
<span class="tel">TELï¼š0749-72-2406</span>
        </div>
      </div>
      <div class="line-wrap" aria-label="LINE é€£çµ¡å…ˆ">
        <img src="lineligo.png" alt="LINE ãƒ­ã‚´">
        <img src="lineqrcode.png" alt="LINE QRã‚³ãƒ¼ãƒ‰">
      </div>
    </section>
  </header>

  <div class="title">ãŠè¦‹ç©æ›¸</div>

  <!-- è¦‹ç©æ˜ç´° -->
  <div class="section-title">è¦‹ç©æ˜ç´°ï¼ˆã‚¨ã‚¢ã‚³ãƒ³æœ¬ä½“ ã»ã‹ï¼‰</div>
  <table id="itemsTable" aria-label="è¦‹ç©æ˜ç´°">
    <thead>
      <tr>
        <th>å“åãƒ»å‹ç•ª</th>
        <th>æ•°é‡<span class="unit-badge">ï¼ˆå°ï¼‰</span></th>
        <th>å˜ä¾¡ï¼ˆç¨è¾¼ï¼‰</th>
        <th>é‡‘é¡ï¼ˆç¨è¾¼ï¼‰</th>
        <th>å‚™è€ƒ</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" placeholder="ä¾‹ï¼‰ãƒ«ãƒ¼ãƒ ã‚¨ã‚¢ã‚³ãƒ³ CS-XXXX" oninput="recalc()"></td>
        <td class="center"><input class="qty-input" type="number" min="0" step="1" value="0" oninput="recalc()"></td>
        <td class="right money"><input type="number" min="0" step="100" value="0" oninput="recalc()"></td>
        <td class="right money"><span class="rowTotal">Â¥0</span></td>
        <td><input type="text" placeholder=""></td>
      </tr>
      <tr>
        <td><input type="text" oninput="recalc()"></td>
        <td class="center"><input class="qty-input" type="number" min="0" step="1" value="0" oninput="recalc()"></td>
        <td class="right money"><input type="number" min="0" step="100" value="0" oninput="recalc()"></td>
        <td class="right money"><span class="rowTotal">Â¥0</span></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td><input type="text" oninput="recalc()"></td>
        <td class="center"><input class="qty-input" type="number" min="0" step="1" value="0" oninput="recalc()"></td>
        <td class="right money"><input type="number" min="0" step="100" value="0" oninput="recalc()"></td>
        <td class="right money"><span class="rowTotal">Â¥0</span></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td><input type="text" oninput="recalc()"></td>
        <td class="center"><input class="qty-input" type="number" min="0" step="1" value="0" oninput="recalc()"></td>
        <td class="right money"><input type="number" min="0" step="100" value="0" oninput="recalc()"></td>
        <td class="right money"><span class="rowTotal">Â¥0</span></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td><input type="text" oninput="recalc()"></td>
        <td class="center"><input class="qty-input" type="number" min="0" step="1" value="0" oninput="recalc()"></td>
        <td class="right money"><input type="number" min="0" step="100" value="0" oninput="recalc()"></td>
        <td class="right money"><span class="rowTotal">Â¥0</span></td>
        <td><input type="text"></td>
      </tr>
    </tbody>
  </table>

  <!-- æ¨™æº–å–ä»˜å·¥äº‹è²» -->
  <div class="section-title">æ¨™æº–å–ä»˜å·¥äº‹è²»</div>
  <table aria-label="æ¨™æº–å–ä»˜å·¥äº‹è²»">
    <thead>
      <tr>
        <th>å†…å®¹</th>
        <th style="width:10%;">å°æ•°<span class="unit-badge">ï¼ˆå°ï¼‰</span></th>
        <th style="width:16%;">å˜ä¾¡ï¼ˆç¨è¾¼ï¼‰</th>
        <th style="width:16%;">é‡‘é¡ï¼ˆç¨è¾¼ï¼‰</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>æ¨™æº–å–ä»˜å·¥äº‹è²»</td>
        <td class="center"><input id="stdQty" class="qty-input" type="number" min="0" step="1" value="1" oninput="recalc()"></td>
        <td class="right money">Â¥<span id="stdUnit">27,500</span></td>
        <td class="right money">Â¥<span id="stdTotal">27,500</span></td>
      </tr>
    </tbody>
  </table>

  <!-- è¿½åŠ å·¥äº‹ï¼šiPadå‘ã‘ãƒœã‚¿ãƒ³ãƒ‘ãƒƒãƒ‰ -->
  <div class="section-title">è¿½åŠ å·¥äº‹</div>

  <div class="add-pad-wrap">
    <div class="pad-row">
      <input id="addSearch" type="text" placeholder="çµã‚Šè¾¼ã¿ï¼ˆä¾‹ï¼šé–‹å£ï¼ç½®å°ï¼é…ç®¡ï¼‰" oninput="renderButtons()" style="flex:1 1 260px;">
      <label style="display:flex; align-items:center; gap:6px;">æ•°é‡
        <input id="padQty" class="qty-input" type="number" min="1" step="1" value="1">
      </label>
    </div>
    <div id="addButtons" class="add-buttons" aria-label="è¿½åŠ å·¥äº‹ãƒœã‚¿ãƒ³ä¸€è¦§"></div>
  </div>

  <!-- è¿½åŠ å·¥äº‹ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <table id="addTable" aria-label="è¿½åŠ å·¥äº‹">
    <thead>
      <tr>
        <th>é …ç›®</th>
        <th>æ•°é‡</th>
        <th>å˜ä¾¡ï¼ˆç¨è¾¼ï¼‰</th>
        <th>é‡‘é¡ï¼ˆç¨è¾¼ï¼‰</th>
        <th class="btn-inline" style="width:10%;">æ“ä½œ</th>
      </tr>
    </thead>
    <tbody><!-- JSã§è¡ŒãŒè¿½åŠ ã•ã‚Œã‚‹ --></tbody>
  </table>

  <!-- åˆè¨ˆ -->
  <div class="section-title">åˆè¨ˆ</div>
  <table aria-label="åˆè¨ˆ">
    <tbody>
      <tr>
        <th style="width:68%;">åˆè¨ˆï¼ˆç¨è¾¼ï¼‰</th>
        <td class="right money" style="width:32%;"><span class="grand-amount">Â¥<span id="grandTotalBottom">0</span></span></td>
      </tr>
    </tbody>
  </table>

  <!-- å‚™è€ƒï¼ˆ[åŒ–ç²§ã‚«ãƒãƒ¼]ã®ã¿ï¼‰ -->
  <div class="section-title">å‚™è€ƒ</div>
  <div class="notes-fixed" aria-label="å›ºå®šã®ã”æ¡ˆå†…">
    <div class="fixed-text">
[åŒ–ç²§ã‚«ãƒãƒ¼]
ã‚«ãƒ©ãƒ¼ï¼ã€€ã‚¢ã‚¤ãƒœãƒªãƒ¼ãƒ»ãƒ–ãƒ©ã‚¦ãƒ³ãƒ»ã‚°ãƒ¬ãƒ¼ãƒ»ãƒ–ãƒ©ãƒƒã‚¯
ã‚µã‚¤ã‚ºï¼ã€€60ã€€ãƒ»ã€€80
    </div>
  </div>
  <!-- è‡ªç”±å…¥åŠ›ãƒ¡ãƒ¢ã¯ç”»é¢ã§ã¯æ®‹ã—ã€å°åˆ·æ™‚ã¯éè¡¨ç¤º -->
  <div class="notes-free-wrap">
    <div class="notes-label">å‚™è€ƒãƒ¡ãƒ¢ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</div>
    <div class="notes" id="notes" contenteditable="true" data-empty="1" aria-label="å‚™è€ƒãƒ¡ãƒ¢ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰"></div>
  </div>

  <!-- ä¸€ç•ªä¸‹ï¼šå°åˆ·é–‹å§‹ãƒœã‚¿ãƒ³ï¼ˆå°åˆ·æ™‚ã¯è‡ªå‹•ã§éè¡¨ç¤ºï¼‰ -->
  <div class="footer-print">
    <button onclick="window.print()">ğŸ–¨ å°åˆ·é–‹å§‹</button>
  </div>

</div>

<script>
  const fmt = (n)=> n.toLocaleString('ja-JP');
  function parseNum(val){
    if(val == null) return 0;
    const s = String(val).replace(/[Â¥ï¿¥å††,\s]/g,'')
      .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™ï¼]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0xFEE0));
    const n = Number(s); return isNaN(n) ? 0 : n;
  }
  const pxPerMm = 96 / 25.4; // CSS pxæ›ç®—

  function makeAddRow(data={}){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" value="${data.item ?? ''}" oninput="recalc()"></td>
      <td class="center"><input class="qty-input" type="number" min="0" step="1" value="${data.qty ?? 0}" oninput="recalc()"></td>
      <td class="right money"><input type="number" min="0" step="100" value="${data.unit ?? 0}" oninput="recalc()"></td>
      <td class="right money"><span class="addRowTotal">Â¥0</span></td>
      <td class="row-actions btn-inline">
        <button onclick="dupAddRow(this)">è¤‡è£½</button>
        <button onclick="delAddRow(this)">å‰Šé™¤</button>
      </td>`;
    return tr;
  }
  function addAddRow(data){ 
    const tb = document.getElementById('addTable').tBodies[0];
    tb.appendChild(makeAddRow(data||{})); recalc();
  }
  function dupAddRow(btn){
    const tr = btn.closest('tr');
    const vals = [...tr.querySelectorAll('input')].map(i=>i.value);
    addAddRow({item:vals[0], qty:parseNum(vals[1]), unit:parseNum(vals[2])});
  }
  function delAddRow(btn){
    const tr = btn.closest('tr');
    tr.parentElement.removeChild(tr); recalc();
  }

  const ADD_MASTER = [
    { name:"å®¶é›»ãƒªã‚µã‚¤ã‚¯ãƒ«å‡¦ç†è²»", unit:3190 },
    { name:"åŸºæœ¬å·¥äº‹ï¼ˆé…ç®¡3mã¾ã§ï¼‰", unit:27500 },
    { name:"åŸºæœ¬å·¥äº‹ï¼ˆ2åˆ†4åˆ†ãƒ»é…ç®¡3mã¾ã§ï¼‰", unit:38500 },
    { name:"é–‹å£å·¥äº‹", unit:3300 },
    { name:"é–‹å£å·¥äº‹ï¼ˆã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã€ç‰¹æ®Šå£ï¼‰", unit:5500 },
    { name:"é…ç®¡å»¶é•·ï¼ˆ1mï¼‰", unit:4400 },
    { name:"å±‹å†…é…ç®¡è€ç†±æ–½å·¥", unit:5500 },
    { name:"ã‚³ãƒ³ã‚»ãƒ³ãƒˆé›»åœ§å¤‰æ›´", unit:2200 },
    { name:"ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼å¢—è¨­", unit:3300 },
    { name:"100Vï¼200Våˆ‡æ›¿å·¥äº‹", unit:3300 },
    { name:"é…ç®¡ã‚«ãƒãƒ¼ãªã—", unit:-5500 },
    { name:"ãƒ›ãƒ¼ãƒ«ã‚­ãƒ£ãƒƒãƒ—", unit:1500 },
    { name:"å’Œå®¤ç”¨ãŸã¦æ¡Ÿ", unit:2200 },
    { name:"å¹³åœ°ç½®å°ï¼ˆC-NGï¼‰", unit:9980 },
    { name:"å¹³åœ°ç½®å°ï¼ˆå¤§ï¼‰ï¼ˆC-NG-Lï¼‰", unit:11000 },
    { name:"å±‹æ ¹å‚¾æ–œç½®å°ï¼ˆC-YGï¼‰", unit:7980 },
    { name:"å£æ›ç½®å°ï¼ˆC-KGï¼‰", unit:8980 },
    { name:"å£æ›ç½®å°ï¼ˆå¤§ï¼‰ï¼ˆC-KG-Lï¼‰", unit:9980 },
    { name:"2æ®µç½®å°ï¼ˆC-WGï¼‰", unit:20000 },
    { name:"2æ®µç½®å°ï¼ˆå¤§ï¼‰ï¼ˆC-WG-Lï¼‰", unit:23000 },
    { name:"å‚¾æ–œå±‹æ ¹ç›´è§’ç½®ç”¨ï¼ˆC-LGï¼‰", unit:11000 },
    { name:"å°‚ç”¨ã‚³ãƒ³ã‚»ãƒ³ãƒˆå·¥äº‹ï¼ˆç¾å ´ã«ã‚ˆã‚Šï¼‰ã€€ï½", unit:12000 },
    { name:"é«˜æ‰€å£æ›è¨­ç½®ï¼ˆç¾å ´ã«ã‚ˆã‚Šï¼‰ã€€ï½", unit:5500 },
    { name:"ã‚¨ã‚¢ã‚³ãƒ³å–ã‚Šå¤–ã—ã®ã¿ï¼ˆç¾å ´ã«ã‚ˆã‚Šï¼‰ã€€ï½", unit:5500 },
  ];

  function renderButtons(){
    const wrap = document.getElementById('addButtons');
    const q = (document.getElementById('addSearch').value || '').trim().toLowerCase();
    const list = q ? ADD_MASTER.filter(it => it.name.toLowerCase().includes(q)) : ADD_MASTER;
    wrap.innerHTML = '';
    list.forEach((it)=>{
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'add-btn';
      btn.title = 'ã‚¿ãƒƒãƒ—ã§è¿½åŠ ';
      btn.innerHTML = `<span class="name">${it.name}</span><span class="unit">Â¥${fmt(it.unit)}</span>`;
      btn.onclick = ()=>{
        const qty = Math.max(1, parseNum(document.getElementById('padQty').value || 1));
        addAddRow({ item: it.name, qty, unit: it.unit });
      };
      wrap.appendChild(btn);
    });
  }

  function recalc(){
    let sum = 0;
    // è¦‹ç©æ˜ç´°
    let itemsTable = document.getElementById('itemsTable').tBodies[0];
    for(let r of itemsTable.rows){
      const qty = Number(r.cells[1].querySelector('input').value || 0);
      const price = Number(r.cells[2].querySelector('input').value || 0);
      const rowTotal = qty * price;
      r.cells[3].querySelector('.rowTotal').textContent = 'Â¥' + fmt(rowTotal);
      sum += rowTotal;
    }
    // æ¨™æº–å–ä»˜å·¥äº‹
    const unit = 27500;
    const q = Math.max(0, Number(document.getElementById('stdQty').value || 0));
    const stdTotal = unit * q;
    document.getElementById('stdUnit').textContent = fmt(unit);
    document.getElementById('stdTotal').textContent = fmt(stdTotal);
    sum += stdTotal;
    // è¿½åŠ å·¥äº‹
    const addTb = document.getElementById('addTable').tBodies[0];
    for(let r of addTb.rows){
      const qty = parseNum(r.cells[1].querySelector('input').value || 0);
      const price = parseNum(r.cells[2].querySelector('input').value || 0);
      const total = qty * price;
      r.cells[3].querySelector('.addRowTotal').textContent = 'Â¥' + fmt(total);
      sum += total;
    }
    document.getElementById('grandTotal').textContent = 'Â¥' + fmt(sum);
    document.getElementById('grandTotalBottom').textContent = fmt(sum);
  }

  function chgStd(delta){
    const el = document.getElementById('stdQty');
    let v = Number(el.value || 0) + delta;
    if(v < 0) v = 0;
    el.value = v;
    document.getElementById('stdCount').textContent = v;
    recalc();
  }

  function updateNotesEmpty(){
    const notes = document.getElementById('notes');
    const wrap  = document.querySelector('.notes-free-wrap');
    if(!notes || !wrap) return;
    const text = notes.innerText.replace(/\s/g,'');
    wrap.classList.toggle('hide-print', text.length === 0);
  }

  let prunedCache = null;
  function pruneEmptyRows(){
    const tbody = document.getElementById('itemsTable').tBodies[0];
    prunedCache = Array.from(tbody.rows).map(r=>r.cloneNode(true));
    const rows = Array.from(tbody.rows); rows.forEach(r=>r.remove());
    prunedCache.forEach(r=>{
      const name = (r.cells[0].querySelector('input').value || '').trim();
      const qty  = Number(r.cells[1].querySelector('input').value || 0);
      if(name && qty>0){ tbody.appendChild(r); }
    });
  }
  function restoreRows(){
    if(!prunedCache) return;
    const tbody = document.getElementById('itemsTable').tBodies[0];
    tbody.innerHTML = '';
    prunedCache.forEach(r=>tbody.appendChild(r));
    prunedCache = null;
  }

  /* --- ã€Œæ§˜ã€ã‚’åå‰ã®æœ€å¾Œã®æ–‡å­—ã‹ã‚‰â€œ15mmâ€å³ã«é…ç½®ï¼ˆå°åˆ·ç›´å‰ã«è¨ˆæ¸¬ï¼‰ --- */
  function placeSama1cmRight(){ // é–¢æ•°åã¯äº’æ›ã®ãŸã‚æ®ãˆç½®ã
    const line = document.querySelector('.to-name-line');
    const nameInput = document.getElementById('toName');
    const sama = document.querySelector('.sama');
    if(!line || !nameInput || !sama) return;

    // å…¥åŠ›æ–‡å­—ã®å®Ÿå¹…ã‚’è¨ˆæ¸¬ï¼ˆåŒãƒ•ã‚©ãƒ³ãƒˆã®ä»®spanã§æ¸¬ã‚‹ï¼‰
    const cs = window.getComputedStyle(nameInput);
    const span = document.createElement('span');
    span.style.position = 'absolute';
    span.style.visibility = 'hidden';
    span.style.whiteSpace = 'pre';
    span.style.fontFamily = cs.fontFamily;
    span.style.fontSize = cs.fontSize;
    span.style.fontWeight = cs.fontWeight;
    span.textContent = nameInput.value || '';
    document.body.appendChild(span);
    const textW = span.getBoundingClientRect().width;
    span.remove();

    const lineRect = line.getBoundingClientRect();
    const nameRect = nameInput.getBoundingClientRect();
    const offsetPx = 15 * (96 / 25.4); // 15mm

    // å…¥åŠ›æ¬„ã®å·¦ç«¯ + æ–‡å­—å¹… + 15mm
    const leftWithinLine = (nameRect.left - lineRect.left) + textW + offsetPx;

    sama.style.position = 'absolute';
    sama.style.left = leftWithinLine + 'px';
    sama.style.top  = (nameRect.top - lineRect.top) + 'px';
  }

  /* ã‚¤ãƒ™ãƒ³ãƒˆ */
  window.addEventListener('DOMContentLoaded', ()=>{
    recalc();
    document.getElementById('stdCount').textContent = document.getElementById('stdQty').value;
    addAddRow({item:'', qty:0, unit:0});   // åˆæœŸç©ºè¡Œ
    renderButtons();
    updateNotesEmpty();
    const notes = document.getElementById('notes');
    if(notes){ notes.addEventListener('input', updateNotesEmpty); }
  });

  if(window.matchMedia){
    const mm = window.matchMedia('print');
    if(mm && mm.addEventListener){
      mm.addEventListener('change', e => {
        if(e.matches){ updateNotesEmpty(); pruneEmptyRows(); placeSama1cmRight(); }
        else{ restoreRows();
          const sama = document.querySelector('.sama');
          if(sama){ sama.style.position=''; sama.style.left=''; sama.style.top=''; }
        }
      });
    }
  }
  window.onbeforeprint = ()=>{ updateNotesEmpty(); pruneEmptyRows(); placeSama1cmRight(); };
  window.onafterprint  = ()=>{ restoreRows();
    const sama = document.querySelector('.sama');
    if(sama){ sama.style.position=''; sama.style.left=''; sama.style.top=''; }
  };
</script>

</body>
</html>